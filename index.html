<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script type="text/javascript">
        var _CACHE_STORE = 'CACHE_STORE';
        var _CACHE_FILE = 'cache.json';

        function init_Page() {
            // We switch between production and testing environments by checking the hash of the URL.
            window.onhashchange = function () {
                var newHash = window.location.hash.substr(1) || 'admin';
                var currentHash = localStorage['module_code'];
                console.log(newHash, currentHash);
                if (newHash != currentHash) {
                    localStorage['module_code'] = newHash;
                    //window.location.reload();
                }
            };

            // Force the initial check.
            window.onhashchange();
        }

        function init_Worker() {
            // Once the Service Worker is activated, init()
            if ('serviceWorker' in navigator) {

                navigator.serviceWorker.getRegistration().then(function (registration) {
                    if (!registration) {

                        navigator.serviceWorker.register('worker.js', { scope: '.' });
                        navigator.serviceWorker.ready.then(function () {
                            init_Page();
                        });

                        return;
                    }

                    //registration.unregister().then(function () {
                    //    console.log('The application has been uninstalled service worker');
                    //    setTimeout(function () { location.reload(); }, 500);
                    //}).catch(function (error) {
                    //    console.log('Error while uninstalling the service worker:');
                    //    console.log(error.message);
                    //});
                });

                //if (navigator.serviceWorker.controller) {
                //    init();
                //} else {
                //    navigator.serviceWorker.register('worker.js', { scope: '.' });
                //    navigator.serviceWorker.ready.then(function () {
                //        init();
                //    });
                //}
            }
        }

        if ('caches' in window) {
            // Clean cache store space
            caches.keys().then(function (names) {
                if (names.length > 0) {
                    for (let name of names) {
                        console.log('[INDEX.JS] Clean cache store: ' + name);
                        caches.delete(name);
                    }
                    window.location.reload();
                }
            });

            //caches.open(_CACHE_STORE).then(function (cache) {
            //    console.log('[INDEX.JS] Set cache file: /index.html');
            //    cache.add('/index.html');
            //});

            // Set cache again via file cache.json
            caches.open(_CACHE_STORE)
                .then(function (cache) {
                    // With the cache opened, load a JSON file containing an array of files to be cached
                    return fetch(_CACHE_FILE).then(function (response) {
                        // Once the contents are loaded, convert the raw text to a JavaScript object
                        return response.json();
                    }).then(function (files) {
                        // Use cache.addAll just as you would a hardcoded array of items
                        console.log('[install] Adding files from JSON file: ', files);
                        return cache.addAll(files);
                    });
                })
                .then(function () {
                    // Message to simply show the lifecycle flow
                    console.log(
                        '[install] All required resources have been cached;',
                        'the Service Worker was successfully installed!'
                    );

                    // Force activation
                    //return self.skipWaiting();
                    init_Worker();
                });;
        } // end cache

    </script>
</head>
<body>
    <style class="cp-pen-styles">
        * {
            padding: 0;
            margin: 0;
        }

        html,
        body {
            background: #2870d5;
            overflow: hidden;
        }

        ul {
            width: 100%;
            line-height: 30px;
            position: absolute;
            top: 50%;
            margin-top: -15px;
            text-align: center;
        }

        li {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: #fff;
            border-radius: 100%;
            position: absolute;
            left: -10px;
        }

            li:nth-child(1) {
                animation: first 7s infinite;
            }

            li:nth-child(2) {
                animation: second 7s infinite;
                animation-delay: .4s;
            }

            li:nth-child(3) {
                animation: third 7s infinite;
                animation-delay: .8s;
            }

            li:nth-child(4) {
                animation: fourth 7s infinite;
                animation-delay: 1.2s;
            }

            li:nth-child(5) {
                animation: fifth 7s infinite;
                animation-delay: 1.6s;
            }

        @keyframes first {
            0% {
                left: -10px;
            }

            25% {
                left: calc(50% + 22px);
            }

            50% {
                left: calc(50% + 22px);
            }

            75% {
                left: calc(100% + 10px);
            }

            100% {
                left: calc(100% + 10px);
            }
        }

        @keyframes second {
            0% {
                left: -10px;
            }

            25% {
                left: calc(50% + 11px);
            }

            50% {
                left: calc(50% + 11px);
            }

            75% {
                left: calc(100% + 10px);
            }

            100% {
                left: calc(100% + 10px);
            }
        }

        @keyframes third {
            0% {
                left: -10px;
            }

            25% {
                left: 50%;
            }

            50% {
                left: 50%;
            }

            75% {
                left: calc(100% + 10px);
            }

            100% {
                left: calc(100% + 10px);
            }
        }

        @keyframes fourth {
            0% {
                left: -10px;
            }

            25% {
                left: calc(50% - 11px);
            }

            50% {
                left: calc(50% - 11px);
            }

            75% {
                left: calc(100% + 10px);
            }

            100% {
                left: calc(100% + 10px);
            }
        }

        @keyframes fifth {
            0% {
                left: -10px;
            }

            25% {
                left: calc(50% - 22px);
            }

            50% {
                left: calc(50% - 22px);
            }

            75% {
                left: calc(100% + 10px);
            }

            100% {
                left: calc(100% + 10px);
            }
        }
    </style>
    <ul>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
</body>
</html>
